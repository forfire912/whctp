# CTP仿真环境配置说明

## ✅ 配置文件已更新

配置文件 `config.json` 已经根据您提供的信息创建完成。

## 📋 当前配置信息

### CTP仿真环境连接
- **交易服务器**: tcp://106.37.101.162:31205
- **行情服务器**: tcp://106.37.101.162:31213
- **BrokerID**: 1010
- **授权码**: YHQHYHQHYHQHYHQH

### MySQL数据库连接
- **主机**: localhost
- **端口**: 3306
- **用户**: root
- **密码**: Aa#123456
- **数据库**: qihuo

## 🔐 需要补充的信息

在 `config.json` 中，以下字段需要您填写真实的CTP账户信息：

```json
{
    "ctp": {
        "user_id": "",      ← 填写您的CTP用户账号
        "password": "",     ← 填写您的CTP交易密码
        "app_id": ""        ← 填写AppID（通常可以留空，某些CTP服务商需要）
    }
}
```

## 🚀 启动步骤（Windows环境）

### 1. 确认MySQL服务已启动
```cmd
# Windows服务管理中启动MySQL服务
# 或者命令行：
net start MySQL
```

### 2. 安装Python依赖
```cmd
pip install pymysql openctp-ctp pandas
```

### 3. 编辑配置文件
用文本编辑器打开 `config.json`，填写：
- `user_id`: 您的CTP用户账号
- `password`: 您的CTP交易密码

### 4. 启动程序
双击 `run.bat` 或运行：
```cmd
python run.py
```

### 5. 使用系统
1. 程序启动后会自动加载配置文件中的连接信息
2. 点击"连接CTP"按钮连接仿真服务器
3. 连接成功后可以：
   - 下载当日委托数据
   - 下载当日持仓数据
   - 订阅行情数据
   - 查询合约信息
   - 启用自动下载功能

## 📊 数据库表结构

程序首次运行时会自动创建以下4个表：

1. **daily_orders** - 当日委托表
   - 记录所有委托订单信息
   - 字段：合约代码、买卖方向、开平标志、价格、数量等

2. **daily_positions** - 当日持仓表
   - 记录持仓明细
   - 字段：合约代码、持仓方向、持仓量、开仓均价等

3. **market_data** - 市场行情表
   - 实时行情数据快照
   - 字段：最新价、涨跌幅、成交量、持仓量等

4. **instrument_info** - 合约信息表
   - 交易所合约基础信息
   - 字段：合约代码、交易所、产品类型、保证金率等

## 🔍 验证连接

### 检查CTP连接
程序日志窗口会显示：
```
[INFO] 开始连接交易服务器: tcp://106.37.101.162:31205
[INFO] 交易服务器连接成功
[INFO] 发送认证请求...
[INFO] 认证成功
[INFO] 登录成功! TradingDay=20251229
```

### 检查数据库连接
程序日志窗口会显示：
```
[INFO] 数据库连接成功: qihuo
[INFO] 数据库表初始化完成
```

## ⚠️ 常见问题

### 1. 连接超时
- 检查网络连接
- 确认仿真服务器地址和端口正确
- 检查防火墙设置

### 2. 认证失败
- 确认BrokerID正确（1010）
- 确认授权码正确（YHQHYHQHYHQHYHQH）
- 确认user_id和password正确

### 3. 数据库连接失败
- 确认MySQL服务已启动
- 确认密码正确（Aa#123456）
- 确认数据库qihuo已存在

### 4. 找不到openctp-ctp库
```cmd
# 安装命令
pip install openctp-ctp
```

## 📞 技术支持

- CTP API版本: SFIT CTP Mini API V1.7.3-P2
- 支持的交易所: SHFE, DCE, CZCE, CFFEX, INE, GFEX
- Python版本要求: 3.7+
- MySQL版本要求: 5.7+

## 🎯 快速测试

启动程序后，可以先测试以下功能：

1. **测试连接**: 点击"连接CTP"，查看是否成功
2. **查询合约**: 点击"下载合约信息"，应该能看到所有可交易合约
3. **下载委托**: 点击"下载委托"，查看当日委托记录
4. **下载持仓**: 点击"下载持仓"，查看当前持仓情况
5. **订阅行情**: 在合约输入框输入合约代码（如：cu2501），点击"订阅行情"

祝您使用愉快！🎉
